<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Violet documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documents for Violet">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="FOREWORD.html"><strong aria-hidden="true">1.</strong> Foreword</a></li><li class="chapter-item expanded "><a href="FAQ.html"><strong aria-hidden="true">2.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="project/index.html"><strong aria-hidden="true">3.</strong> Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="project/development.html"><strong aria-hidden="true">3.1.</strong> Development</a></li><li class="chapter-item expanded "><a href="project/hardware-requirements.html"><strong aria-hidden="true">3.2.</strong> Hardware requirements</a></li></ol></li><li class="chapter-item expanded "><a href="concepts/index.html"><strong aria-hidden="true">4.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="concepts/applications.html"><strong aria-hidden="true">4.1.</strong> What are applications?</a></li><li class="chapter-item expanded "><a href="concepts/libraries.html"><strong aria-hidden="true">4.2.</strong> What are libraries?</a></li><li class="chapter-item expanded "><a href="concepts/users.html"><strong aria-hidden="true">4.3.</strong> What are users?</a></li></ol></li><li class="chapter-item expanded "><a href="technical/index.html"><strong aria-hidden="true">5.</strong> Technical</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="technical/overview.html"><strong aria-hidden="true">5.1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="technical/dev-mode.html"><strong aria-hidden="true">5.2.</strong> Developer Mode</a></li><li class="chapter-item expanded "><a href="technical/integrity.html"><strong aria-hidden="true">5.3.</strong> Integrity</a></li><li class="chapter-item expanded "><a href="technical/multi-platform.html"><strong aria-hidden="true">5.4.</strong> Multi-platform management</a></li><li class="chapter-item expanded "><a href="technical/pre-compiling.html"><strong aria-hidden="true">5.5.</strong> Pre-compiling</a></li><li class="chapter-item expanded "><a href="technical/iona.html"><strong aria-hidden="true">5.6.</strong> I/O manager</a></li><li class="chapter-item expanded "><a href="technical/devices.html"><strong aria-hidden="true">5.7.</strong> Devices</a></li><li class="chapter-item expanded "><a href="technical/processes.html"><strong aria-hidden="true">5.8.</strong> Processes</a></li><li class="chapter-item expanded "><a href="technical/services.html"><strong aria-hidden="true">5.9.</strong> Services</a></li></ol></li><li class="chapter-item expanded "><a href="specs/index.html"><strong aria-hidden="true">6.</strong> Specifications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specs/apps-and-libraries.html"><strong aria-hidden="true">6.1.</strong> Applications and libraries</a></li><li class="chapter-item expanded "><a href="specs/applications.html"><strong aria-hidden="true">6.2.</strong> Applications</a></li><li class="chapter-item expanded "><a href="specs/filesystem.html"><strong aria-hidden="true">6.3.</strong> Filesystem</a></li><li class="chapter-item expanded "><a href="specs/kernel/index.html"><strong aria-hidden="true">6.4.</strong> Kernel</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specs/kernel/kpc.html"><strong aria-hidden="true">6.4.1.</strong> Kernel-process Communication</a></li><li class="chapter-item expanded "><a href="specs/kernel/syscalls.html"><strong aria-hidden="true">6.4.2.</strong> System calls</a></li></ol></li><li class="chapter-item expanded "><a href="specs/services/index.html"><strong aria-hidden="true">6.5.</strong> System services</a></li></ol></li><li class="chapter-item expanded "><a href="applications/index.html"><strong aria-hidden="true">7.</strong> Applications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="applications/dahlia.html"><strong aria-hidden="true">7.1.</strong> Dahlia</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Violet documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/violet-eco/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="foreword"><a class="header" href="#foreword">Foreword</a></h1>
<ul>
<li><a href="FOREWORD.html#foreword">Foreword</a>
<ul>
<li><a href="FOREWORD.html#welcome">Welcome!</a>
<ul>
<li><a href="FOREWORD.html#what-is-violet">What is Violet?</a></li>
<li><a href="FOREWORD.html#whats-the-projects-structure">What's the project's structure?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="welcome"><a class="header" href="#welcome">Welcome!</a></h2>
<p>Welcome to the documentation of Violet!
These documents will show you how the system is designed,
how it works and what it can offer the end user.</p>
<p><strong>Before reading these documents, consider that</strong>
I'm developing this project on my own and am not an expert.</p>
<p>This means that there may be mistakes in low-level documents.
If you find a mistake, feel free to <a href="https://github.com/lapis-org/docs/issues/new/choose">submit an issue</a>.</p>
<h3 id="what-is-violet"><a class="header" href="#what-is-violet">What is Violet?</a></h3>
<p>Violet is an operating system that aims to replace
legacy systems such as macOS, Linux, and Windows.
Of course, we know how Windows/macOS/Linux are
installed on today's devices. Therefore, Violet
is a theoretical operating system that shows how
an operating system that does not provide backward
compatibility with older architectures will look like.</p>
<h3 id="whats-the-projects-structure"><a class="header" href="#whats-the-projects-structure">What's the project's structure?</a></h3>
<p>The project consists of three different parts:
<em>the kernel</em>, <em>the system</em> and <em>the desktop environment</em>.</p>
<p><strong>The kernel</strong> basically allows software to access hardware.
It is a microkernel, so unlike a monolithic kernel
like Linux, potential security issues are greatly reduced.</p>
<p><strong>The system</strong> contains everything not directly related
to hardware or graphical interface. Examples of this
are applications, user accounts, and permission management.</p>
<p><strong>The desktop environment</strong> is what the user sees from the launch of Violet.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h1>
<ul>
<li><a href="FAQ.html#frequently-asked-questions">Frequently Asked Questions</a>
<ul>
<li><a href="FAQ.html#will-this-project-replace-windowsmacoslinux-one-day">Will this project replace Windows/macOS/Linux/... one day?</a></li>
<li><a href="FAQ.html#how-can-i-help">How can I help?</a></li>
</ul>
</li>
</ul>
<h2 id="will-this-project-replace-windowsmacoslinux-one-day"><a class="header" href="#will-this-project-replace-windowsmacoslinux-one-day">Will this project replace Windows/macOS/Linux/... one day?</a></h2>
<p>No, it's impossible. Because ignoring backward compatibility
for legacy architectures and already existing software is
simply not viable for an operating system. Users first
look at applications in an operating system, <strong>then</strong> the system
itself - for security, stability, performance, etc.</p>
<p>Imagine that someone offers you a great operating system, but
there are almost no applications in it. Would you still use
this OS instead of Windows/macOS/Linux? Of course no!</p>
<p>That's why this project is <strong>purely theoretical</strong>.</p>
<h2 id="how-can-i-help"><a class="header" href="#how-can-i-help">How can I help?</a></h2>
<p>Help is very welcome but there's not many things to help with currently,
as the system is still being designed. You can still help by suggesting
improvements or fixing an error (whatever it is, a design problem or a simple typo)
by <a href="https://github.com/violet-eco/docs/issues/new/choose">submitting an issue</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project"><a class="header" href="#project">Project</a></h1>
<p>This folder contains the documentation about the proejct itself.</p>
<ul>
<li><a href="project/development.html">Development</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development"><a class="header" href="#development">Development</a></h1>
<ul>
<li><a href="project/development.html#development">Development</a>
<ul>
<li><a href="project/development.html#languages">Languages</a></li>
</ul>
</li>
</ul>
<h2 id="languages"><a class="header" href="#languages">Languages</a></h2>
<p>The project will be developed in <a href="https://www.rust-lang.org/">RustÂ®</a>,
with first-class support for this language.</p>
<p>The use of architecture-specific Assembly will be reduced
as much as possible and will only be used in the following two cases:</p>
<ul>
<li>Targeted behavior cannot be achieved without
Assembly (e.g. registers and stack manipulation)</li>
<li>Extremely performance-critical parts</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hardware-requirements"><a class="header" href="#hardware-requirements">Hardware requirements</a></h1>
<p>This document presents the minimal hardware requirements
required by Violet in order to work. This is also means Violet
will work on any computer with these attributes.</p>
<ul>
<li><strong>Processor:</strong> <code>aarch64</code> (64-bit ARM, <em>recommended</em>) or <code>amd64</code> (x86-64) processor</li>
<li><strong>Memory:</strong> <em>to be determined</em></li>
<li><strong>Storage:</strong> <em>to be determined</em></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<p>This folder contains the high-level documents of Violet.
It is written in a way that readers can easily understand.</p>
<ul>
<li><a href="concepts/applications.html">What are applications?</a> - the way to run software on Violet</li>
<li><a href="concepts/libraries.html">What are libraries?</a> -  sharing identical behaviours between multiple applications</li>
<li><a href="concepts/users.html">What are users?</a> - sharing a computer between multiple persons </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-are-applications"><a class="header" href="#what-are-applications">What are applications?</a></h1>
<p><em>Applications</em> are the way the operating system processes software.</p>
<ul>
<li><a href="concepts/applications.html#what-are-applications">What are applications?</a>
<ul>
<li><a href="concepts/applications.html#how-applications-work">How applications work?</a></li>
<li><a href="concepts/applications.html#installation-methods">Installation Methods</a>
<ul>
<li><a href="concepts/applications.html#from-the-store">From the store</a></li>
<li><a href="concepts/applications.html#sideloading">Sideloading</a></li>
<li><a href="concepts/applications.html#volatile-applications">Volatile applications</a></li>
</ul>
</li>
<li><a href="concepts/applications.html#commands">Commands</a></li>
<li><a href="concepts/applications.html#system-applications">System Applications</a></li>
<li><a href="concepts/applications.html#services">Services</a></li>
</ul>
</li>
</ul>
<h2 id="how-applications-work"><a class="header" href="#how-applications-work">How applications work?</a></h2>
<p>An application basically consists of executable files and resources.
Because binary programs are not supported directly, <strong>applications are the only way to run code</strong>.</p>
<h2 id="installation-methods"><a class="header" href="#installation-methods">Installation Methods</a></h2>
<p>All applications are installed through <em>application packages</em>.
There are several installation methods:</p>
<ul>
<li>From the store</li>
<li>Directly from the app's package</li>
<li>As a volatile application</li>
</ul>
<h3 id="from-the-store"><a class="header" href="#from-the-store">From the store</a></h3>
<p>Applications can be downloaded and installed from the official store of Violet.</p>
<p><strong>For closed source applications</strong>, the store only provides precompiled programs.</p>
<p><strong>For open source applications</strong>, the store provides both precompiled
programs and support for compiling from source.</p>
<p>Users can compile applications from source using the appropriate tools
to compile, or simply use precompiled programs (default) and change
the default option at any time.</p>
<h3 id="sideloading"><a class="header" href="#sideloading">Sideloading</a></h3>
<p><em>Sideloading (installing an application directly from its package)</em> follows
certain rules set by the sideloading mode, called &quot;disable&quot;, &quot;secure&quot;, &quot;insecure&quot;.</p>
<ul>
<li><strong>Disable mode</strong> blocks all sideloading, in this mode it is not possible to install apps via packages, but <a href="concepts/applications.html#volatile-applications">volatile apps</a> can still be run.</li>
<li><strong>Safe mode</strong> allows sideloading and makes the system check if the application's AID matches an appllication available in the Store. If it matches, it compares the signature of the application with the signature of the Store Application. If the signatures do not match, the application is considered <em>malicious</em> and will not be installed. Also note that this mod only works when the computer is connected to the internet, as the system needs to check the Store to see if the application is malicios. If the computer is offline, sideloading will be disabled.</li>
<li><strong>Insecure mode</strong> allows sideloading without any checking, which is quite dangerous as it allows spoofing.</li>
</ul>
<p>Sideloading mode can be changed in Control Center.</p>
<h3 id="volatile-applications"><a class="header" href="#volatile-applications">Volatile applications</a></h3>
<p>Applications can also be run as <em>volatile applications</em>, which
means they are not installed to disk:</p>
<ul>
<li><strong>Full-volatile:</strong> all data of the application is deleted after the application is closed</li>
<li><strong>Session-scoped:</strong> the application's data is kept on disk until the system is shut down</li>
<li><strong>Local-persisent:</strong> the application's data is stored in a data file with extension <code>*.vad</code> created in the same folder</li>
<li><strong>Persistent:</strong> the application's data is stored in a dedicated folder</li>
</ul>
<p>By default, volatile applications run in <em>local-persistent</em> mode.
In this mode, the system first searches for a file in the same
folder with the same name as the application's package file,
but with the extension <code>*.vad</code> <em>(Volatile Application Data)</em>.
If the file is found, it opens it as the application's storage.
Thus, when the application wants to store data, it is stored in the data file.</p>
<p>Note that <code>*.vad</code> <em>(Volatile Application Data)</em> files are disguised
VSF (Virtual Storage File) files.</p>
<p><em>Persistently running apps</em> are not listed in the app list and can only be
managed through an option in the Control Center. While its data is stored
on disk, its executables are not stored anywhere, they just stay inside
the package. This allows running the same application multiple times and
not worrying about the data file. It also supports shared data storage between users.</p>
<p>Note that the store has an option for installing applications as volatile.</p>
<h2 id="commands"><a class="header" href="#commands">Commands</a></h2>
<p>Applications can provide shell commands. Since command names must prefixed
by the AID (dots instead of two colons), multiple commands can be provided without the danger of name conflicts.</p>
<p>For example, if an app with AID <code>developer::app</code> provides the command <code>get_time</code>, the last available command will be <code>developer.app.get_time</code>.</p>
<p>Although this is a rather long name, it avoids conflicts between
the names of the commands. It is quite common for shell scripts to
import commands at the beginning of the script to make it easier
to access applications' commands.</p>
<p>By default, shell prompts (not scripts) will allow use directly
in the short form <code>get_time</code> if no other application provides
a command with the same name.</p>
<p>Commands work by running the application through a specific <em>execution context</em>.</p>
<h2 id="system-applications"><a class="header" href="#system-applications">System Applications</a></h2>
<p>Some native applications are part of the system itself and
are called <em>system applications</em>. These applications have some special privileges:</p>
<ul>
<li>Access to system-reserved features</li>
<li>Permission to create <em>system service</em></li>
<li>They cannot be uninstalled</li>
</ul>
<p>System applications cannot be removed <em>by any means</em> as
they are critical to the correct functioning of the system.
Native applications which are not system applications can be removed, though.</p>
<h2 id="services"><a class="header" href="#services">Services</a></h2>
<p>Applications can create <em>services</em> by specifying them in their manifests.
The services will run at startup with the application's permissions.</p>
<p>There is exactly one process for each service per active user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-are-libraries"><a class="header" href="#what-are-libraries">What are libraries?</a></h1>
<ul>
<li><a href="concepts/libraries.html#what-are-libraries">What are libraries?</a>
<ul>
<li><a href="concepts/libraries.html#how-libraries-work">How libraries work?</a></li>
</ul>
</li>
</ul>
<h2 id="how-libraries-work"><a class="header" href="#how-libraries-work">How libraries work?</a></h2>
<p>Unlike applications, libraries can be installed in multiple
versions. This means you can have three versions of the same
library installed at the same time on your computer.</p>
<p>When an application wants to use a library, it explicitly indicates
the list of versions it is compatible with. The system gets the related
version and provides it to the application.</p>
<p>A library by itself cannot do itself; no background process, no commands
exposure, no permission granting. Applications simply use libraries as
helpers to achieve specific tasks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-are-users"><a class="header" href="#what-are-users">What are users?</a></h1>
<ul>
<li><a href="concepts/users.html#what-are-users">What are users?</a>
<ul>
<li><a href="concepts/users.html#the-concept">The concept</a></li>
<li><a href="concepts/users.html#users-type">Users type</a></li>
<li><a href="concepts/users.html#dangers-of-an-administrator-account">Dangers of an administrator account</a></li>
<li><a href="concepts/users.html#user-privileges-elevation-upe">User Privileges Elevation (UPE)</a></li>
<li><a href="concepts/users.html#groups">Groups</a></li>
</ul>
</li>
</ul>
<h2 id="the-concept"><a class="header" href="#the-concept">The concept</a></h2>
<p>Most computers are intended to be shared among many people.
In such a situation it is quite useful to separate each user's
data from each other and restrict access to the other.</p>
<p>By default, there are two user accounts: the <em>System</em> and the <em>Administrator</em>.
They are called <em>virtual users</em> because it is not possible to log in these accounts.
Other users are called <em>custom users</em>.</p>
<p>Each custom user has a data folder called <em>home directory</em> designated as <code>/home/[username]</code>.
Users can access the files and folders inside this folder and do whatever they want.
By default, each user has access to:</p>
<ul>
<li>Its home directory in <code>/home/[username]</code></li>
<li>The mounted units in <code>/media</code></li>
<li>Its temporary directory in <code>/tmp/[username]</code></li>
</ul>
<h2 id="users-type"><a class="header" href="#users-type">Users type</a></h2>
<p>Each user is in one of these types:</p>
<ul>
<li><strong>Phantom:</strong> all data of the user is deleted after the computer is turned off</li>
<li><strong>Standard:</strong> nothing special</li>
<li><strong>Administrator:</strong> can run programs directly as administrator</li>
<li><strong>Main administrator:</strong> administrator account that can manage storage encryption</li>
</ul>
<p>When a user wants to perform a task for which he is not authorized,
it may want to run the task as another user. The other user's login
informations are required then.</p>
<p>A task cannot be performed as system or administrator because these
accounts are virtual and have no passwords, <strong>except</strong> if an administrator
user tries to run a task as administrator.</p>
<p>Keep in mind that there is always only one and exactly one administrator.
This account is created during the installation process and can later be transferred
to another administrator account.</p>
<h2 id="dangers-of-an-administrator-account"><a class="header" href="#dangers-of-an-administrator-account">Dangers of an administrator account</a></h2>
<p>The problem with the administrator account is that <strong>it can do anything</strong> (except
some very specific things). They can change system settings, read and modify other users'
data, and even run background processes on startup.
They also have all possible permissions.</p>
<p>Having two administrator accounts on one computer is <strong>definitely</strong> not
recommended unless both accounts are used by trusted people. For this reason,
a large warning is shown when you try to create a new administrator account.</p>
<h2 id="user-privileges-elevation-upe"><a class="header" href="#user-privileges-elevation-upe">User Privileges Elevation (UPE)</a></h2>
<p>Users can request permission to run a task as another user, such as running as administrator.</p>
<p>In such a case, the program is still run as the same user, but with the same user's
privileges and the user's privileges specified to the UPE.</p>
<p>To run a program with UPE, either knowing the user's password or <em>authorization</em>
from this user is required. For example, administrator accounts are <em>authorized</em>
to use the Administrator account without specifying a password.</p>
<p>Successful or not, every request is logged in the log file at <code>/etc/logs/auc</code>.</p>
<h2 id="groups"><a class="header" href="#groups">Groups</a></h2>
<p>Groups are a set of privileges defined by the administrator. Access some folders or application's permissions (e.g. microphone access) can be restricted to a specific group, for instance. When a user is created, it can be put in a group. It then automatically inherits all of the group's privileges, in addition to its own ones. The administrator can add and remove users from groups with the control panel.</p>
<p>When a user is in a group, the group's privileges cannot be revoked for this user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="technical"><a class="header" href="#technical">Technical</a></h1>
<p>This folder contains technical documentation with explanations about, Violet's low-level parts.</p>
<p>For an overview of the system, you can view the <a href="technical/overview.html">overview document</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="technical-1"><a class="header" href="#technical-1">Technical</a></h1>
<p>This document provides an overview of Violet.</p>
<ul>
<li><a href="technical/overview.html#technical">Technical</a>
<ul>
<li><a href="technical/overview.html#program-executions">Program executions</a></li>
<li><a href="technical/overview.html#permissions">Permissions</a></li>
<li><a href="technical/overview.html#hardware-access">Hardware access</a></li>
<li><a href="technical/overview.html#hardware-drivers">Hardware drivers</a>
<ul>
<li><a href="technical/overview.html#hardware-access-performances">Hardware access performances</a></li>
</ul>
</li>
<li><a href="technical/overview.html#filesystem-access">Filesystem access</a></li>
<li><a href="technical/overview.html#user-interface">User interface</a></li>
</ul>
</li>
</ul>
<h2 id="program-executions"><a class="header" href="#program-executions">Program executions</a></h2>
<p>Violet does not allow to run standalone binaries.
Every running code is either:</p>
<ul>
<li>Part of the system, as the kernel itself or as a system service</li>
<li>Part of an <a href="technical//docs/concepts/users.html">application</a></li>
</ul>
<h2 id="permissions"><a class="header" href="#permissions">Permissions</a></h2>
<p>The system has all possible privileges over the system itself.
Applications, on the other hand, have almost no privileges by default.</p>
<p>These privileges can be provided through <em>permissions</em> designed
to control which application can do what.</p>
<h2 id="hardware-access"><a class="header" href="#hardware-access">Hardware access</a></h2>
<p>Accessing the hardware happens in a two-layered way:</p>
<ul>
<li>First, the kernel <em>detects</em> the hardware and <em>enumerates</em> it</li>
<li>Then this hardware will be available through the <em>hardware service</em></li>
</ul>
<h2 id="hardware-drivers"><a class="header" href="#hardware-drivers">Hardware drivers</a></h2>
<p>Unlike most other operating systems,hardware drivers are
simple applications with no special integration in the kernel.</p>
<p>An application's manifest can mark itself as a driver using the <em>hardware service</em>.</p>
<p>The appropriate driver for each hardware is selected by using <em>certain criteria</em>.</p>
<h3 id="hardware-access-performances"><a class="header" href="#hardware-access-performances">Hardware access performances</a></h3>
<p>Hardware accesses are provided via <em>syscall</em> and <em>signals</em> using CPU interrupts.</p>
<p>The access process usually works like this:</p>
<ul>
<li>A userspace process notifies a <em>system service</em></li>
<li>The system service contacts the corresponding hardware service</li>
<li>The hardware service contacts the relevant driver</li>
<li>The hardware driver performs the requested operation through the <em>hardware service</em></li>
<li>Next, the result of the operation is transmitted to the hardware service, then to the system service, and finally to the userspace process</li>
</ul>
<h2 id="filesystem-access"><a class="header" href="#filesystem-access">Filesystem access</a></h2>
<p>This process is generally faster than other hardware operations
thanks to <em>direct storage access</em>.</p>
<p>A typical operation involves a communication with the <em>filesystem service</em>,
which <em>directly communicates</em> with the storage files.</p>
<p>For filesystems that are not natively supported, a <em>filesystem interface</em>
is available to contact the <em>storage driver service</em>. Although this process
has more latency, it is only referenced in edge cases and still remains
within an acceptable performance range.</p>
<h2 id="user-interface"><a class="header" href="#user-interface">User interface</a></h2>
<p>The entire user interface is managed by desktop environments,
which are the services provided by the applications.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="developer-mode"><a class="header" href="#developer-mode">Developer Mode</a></h1>
<p>The developer mode enables several features that are not
available by default. Only administrator user get access to
them when they are enabled.</p>
<ul>
<li><a href="technical/dev-mode.html#developer-mode">Developer Mode</a>
<ul>
<li><a href="technical/dev-mode.html#how-to-enable">How to enable?</a></li>
<li><a href="technical/dev-mode.html#application-proxies">Application proxies</a></li>
</ul>
</li>
</ul>
<h2 id="how-to-enable"><a class="header" href="#how-to-enable">How to enable?</a></h2>
<p>Developer mode can be enabled either by typing the following command
in the terminal:</p>
<pre><code class="language-sh">vio central --enable dev-mode
</code></pre>
<p>Or, while holding the <code>Ctrl</code> <code>Alt</code> and <code>Maj</code> key, type <code>DEV</code>.</p>
<h2 id="application-proxies"><a class="header" href="#application-proxies">Application proxies</a></h2>
<p>Application proxies collect all calls made by the application to the system.
It is useful for applications debugging.</p>
<p>When a proxy is set up for an application, all system calls sent to this application
will be transferred to the proxy, which will be able to do whatever it wants with it.
It's possible for the proxy to never answer the signal, to change its content before actually sending it to the system, etc.</p>
<p>Basic usage of an application proxy is as a &quot;listener&quot;: it only listens to
specific signals and logs them, without cancelling them and/or modifying them.
This is useful to check all filesystem access requested by an application, in real time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="integrity"><a class="header" href="#integrity">Integrity</a></h1>
<ul>
<li><a href="technical/integrity.html#integrity">Integrity</a>
<ul>
<li><a href="technical/integrity.html#system-immutability">System immutability</a></li>
<li><a href="technical/integrity.html#hashes">Hashes</a></li>
<li><a href="technical/integrity.html#checking-hashes">Checking hashes</a></li>
</ul>
</li>
</ul>
<h2 id="system-immutability"><a class="header" href="#system-immutability">System immutability</a></h2>
<p>The <code>/sys</code> folder is immutable, which means that even the
main administrator cannot change this folder. <strong>The only process</strong>
this folder changes is the repair process or update run by the system itself.</p>
<h2 id="hashes"><a class="header" href="#hashes">Hashes</a></h2>
<p>When written to critical files in <code>/sys</code> or <code>/sys/etc</code>,
their hashes are calculated using the <a href="https://github.com/BLAKE3-team/BLAKE3"><code>BLAKE3</code></a> algorithm and stored in
the system's <em>hash registry</em> (the <code>/etc/sys/hashes</code> file).</p>
<h2 id="checking-hashes"><a class="header" href="#checking-hashes">Checking hashes</a></h2>
<p>When these files are initially read, their contents are calculated
and compared with the hash registry. If the hashes don't match,
the file is considered as <em>corrupted</em>. The consequences depend on the location
of the file:</p>
<ul>
<li><strong>System</strong> (<code>/sys</code>): the system will check its backup integrity and then restore itself from the backup</li>
<li><strong>System backup</strong> (<code>/sys/backup</code>): the system will check its backup integrity and then restore itself from the backup</li>
<li><strong>System + system backup</strong>: the system won't boot and indicate it must be reinstalled (documents won't be lost if they aren't corrupted) It's possible to force the boot process, but a large warning will indicate it may cause crashes or even introduce security issues</li>
<li><strong>Hash registry</strong> (<code>/etc/sys/hashes</code>): same as <em>system + system backup</em></li>
<li><strong>Registry</strong> (<code>/etc/sys/registry</code>): same as <em>system + system backup</em></li>
<li><strong>Crash save:</strong> the crash saves won't be restored (can be forced)</li>
<li><strong>Sandbox:</strong> system will refuse to start the sandbox (can be forced)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multi-platform-management"><a class="header" href="#multi-platform-management">Multi-platform management</a></h1>
<p>Violet ecosystem programs can be run on Linux, Windows,
or macOS systems using a wrapper called the <em>Violet Calls Wrapper</em>.
It can be downloaded from Violet's website.</p>
<p>When installed on a system, it serves to run Violet applications natively,
although the permission management does not work perfectly and some features
cannot be implemented (e.g. no desktop, no access to native Violet applications -
only native libraries etc.)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pre-compiling"><a class="header" href="#pre-compiling">Pre-compiling</a></h1>
<p>In traditional systems, programs are distributed as
binary and are only availeble for one specific platform (Windows, Linux, macOS, ...)
with a specific architecture (x86, ARM, ...).</p>
<p>To prevent this and to make native programs more stable and
secure, Violet applications are distributed as <em>Violet Pre-compiled Programs</em>
(VPP) using a special very low-level language called <a href="https://github.com/violet-eco/rosa"><strong>Rosa</strong></a>.</p>
<ul>
<li><a href="technical/pre-compiling.html#pre-compiling">Pre-compiling</a>
<ul>
<li><a href="technical/pre-compiling.html#how-it-works">How it works?</a></li>
<li><a href="technical/pre-compiling.html#compatibility">Compatibility</a></li>
</ul>
</li>
</ul>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works?</a></h2>
<p><a href="https://github.com/violet-eco/rosa"><strong>Rosa</strong></a> is very similar to WebAssembly: compressed very low-level
source files that are built ahead of time on the machine that will
run it. This enables several advantages:</p>
<ul>
<li>Programs are multi-platform and multi-architecture</li>
<li>Programs run faster thanks to being optimized for the specific machine they will run on</li>
<li>Programs are still very fast to compile</li>
<li>Source code is protected for closed-source applications as Rosa is made of basic instructions</li>
</ul>
<h2 id="compatibility"><a class="header" href="#compatibility">Compatibility</a></h2>
<p>Rosa can also run on non-Violet operating systems using a lightweight
wrapper available on Violet's website.</p>
<p><strong>NOTE:</strong> Although Rosa is multi-platform, Violet apps use Violet's
ultra-beautiful features that are <em>not</em> natively supported on other platforms.
To run such applications, you must install the <a href="technical/multi-platform.html">full wrapper</a> available on the website.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-nano-manager"><a class="header" href="#io-nano-manager">I/O Nano-manager</a></h1>
<p>The <em>Input/Output Nano-manager</em>, known as <em>Iona</em>, is the
part of the system that handles the input/output requests of processes.</p>
<p>Concretely, it is represented by the <code>sys::hw</code> service.</p>
<ul>
<li><a href="technical/iona.html#io-nano-manager">I/O Nano-manager</a>
<ul>
<li><a href="technical/iona.html#hardware-access">Hardware access</a>
<ul>
<li><a href="technical/iona.html#requests-priority">Requests priority</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="hardware-access-1"><a class="header" href="#hardware-access-1">Hardware access</a></h2>
<p>When a process tries to access hardware, that request goes to Iona,
which will either allow or deny it.</p>
<p>System services such as <code>sys::fs</code> or <code>sys::net</code> use Iona to
deal with the related hardware devices.</p>
<h3 id="requests-priority"><a class="header" href="#requests-priority">Requests priority</a></h3>
<p>The requests of the processes are treated according to their
priority determined by their arrival timestamp. But it can also be
treated by priority of processes, I/O requests of the process with
higher priority are run faster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="devices"><a class="header" href="#devices">Devices</a></h1>
<ul>
<li><a href="technical/devices.html#devices">Devices</a>
<ul>
<li><a href="technical/devices.html#connecting-a-new-device">Connecting a new device</a></li>
<li><a href="technical/devices.html#interacting-with-a-device">Interacting with a device</a></li>
<li><a href="technical/devices.html#device-handler-files-persistance">Device handler files persistance</a></li>
<li><a href="technical/devices.html#custom-dhf-name">Custom DHF name</a></li>
</ul>
</li>
</ul>
<h2 id="connecting-a-new-device"><a class="header" href="#connecting-a-new-device">Connecting a new device</a></h2>
<p>When a new device is connected to the computer, a new
device handler file (DHF) is created in the <code>/dev</code> directory.</p>
<p>Depending on the type, they can be put in different folders under the <code>/dev</code> folder.</p>
<p>The filename is random and unique, in the format <code>[a-z][0-9][a-z][0-9]</code> (lowercase, digit, then lowercase again, and finally another digit).</p>
<p>For example, when a hard drive is connected to the computer,
DHF will be something like <code>/dev/sst/b0b4</code>.</p>
<h2 id="interacting-with-a-device"><a class="header" href="#interacting-with-a-device">Interacting with a device</a></h2>
<p>DHFs can only be used through the <code>sys::hw</code> service.</p>
<p>Different actions may be happen depending on the device's type:</p>
<ul>
<li><strong>Camera devices:</strong> when an application asks to capture a photo/video, the device will be suggested to take the images from</li>
<li><strong>Microphones:</strong> when an application asks to capture sound, the device will be suggested to capture the sound from</li>
<li><strong>Sound output devices:</strong> the device will be available for playback</li>
<li><strong>Network adapters:</strong> the device will be available to make network requests on</li>
<li><strong>Other supported wireless devices:</strong> depends on the type (Bluetooth adapter, ...)</li>
<li><strong>Basic/persistent storage devices:</strong> when possible, the device will be automatically mounted in <code>/mnt</code> and visible in the files explorer</li>
</ul>
<p>For uncategorized devices (in <code>/dev/etc</code>), a popup is shown to the user, to indicate
the connected device is not recognized.</p>
<h2 id="device-handler-files-persistance"><a class="header" href="#device-handler-files-persistance">Device handler files persistance</a></h2>
<p>When a device is disconnected, its DHF is not removed. Instad, if a process tries to
interact with the DHF, the <code>sys::hw</code> service will indicate the device is currently not connected.</p>
<p>When the device is connected again, it is associated to the same DHF again. This allows
applications to persist the device's location and use it later on.</p>
<h2 id="custom-dhf-name"><a class="header" href="#custom-dhf-name">Custom DHF name</a></h2>
<p>It is possible to give custom names to DHFs. In such a case, a new DHF file is created and
linked to the original DHF file while keeping the original DHF file in the folder.
In this way, compatibility with applications that rely on the old DHF is not broken.</p>
<p>Both DHFs show exactly the same device, with no difference. Custom DHF can be
deleted at any time, but this can be quite dangerous as some applications rely on it.</p>
<p>Also, custom DHF names must always be longer than 4 characters, to avoid
confusion with automatically-generated DHFs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="processes"><a class="header" href="#processes">Processes</a></h1>
<p>Violet's processes are implemented quite similarly to
Linux's processes, with a few new features. There are
several types of processes:</p>
<ul>
<li><strong>System processes</strong>, which are created by the system</li>
<li><strong>Application processes</strong>, which aplications run in</li>
<li><strong>Worker processes</strong>, in which applications' workers run</li>
</ul>
<p>System processes are called <em>low-level processes</em>, while
application and worker processes are called <em>userspace processes</em>.</p>
<ul>
<li><a href="technical/processes.html#processes">Processes</a>
<ul>
<li><a href="technical/processes.html#child-processes">Child processes</a></li>
<li><a href="technical/processes.html#threading">Threading</a></li>
</ul>
</li>
</ul>
<h2 id="child-processes"><a class="header" href="#child-processes">Child processes</a></h2>
<p>A process can create <em>child processes</em>. The child process will
roughly be a 1:1 copy of the parent process, but with its
own unique PID.</p>
<p>To avoid copying the whole memory, copy-on-write is used. This
means that the pages are identical and don't require any allocation
until they are modified.</p>
<p>Child processes automatically inherit their parent's permissions.</p>
<p>When a process exits, all its child processes are immediately killed.</p>
<h2 id="threading"><a class="header" href="#threading">Threading</a></h2>
<p>A process can create <em>threads</em>, which are still part of the process.
Threads allow to run multiple part of a process concurrently.</p>
<p>All threads share the same address space and memory.</p>
<p>To avoid copying the whole memory, copy-on-write is used. This
means that the pages are identical and don't require any allocation
until they are modified.</p>
<p>The stack is local to each thread.</p>
<p>Thread works as a hierarchy, when a thread exits, all its children
are immediately killed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="services-1"><a class="header" href="#services-1">Services</a></h1>
<p>A <em>service</em> is a process that launches at startup and
may receive IPC messages from any process.</p>
<ul>
<li><a href="technical/services.html#services">Services</a>
<ul>
<li><a href="technical/services.html#system-services">System services</a></li>
<li><a href="technical/services.html#application-services">Application services</a></li>
</ul>
</li>
</ul>
<h2 id="system-services"><a class="header" href="#system-services">System services</a></h2>
<p>System services are native applications.
They have system privileges and can do whatever they want.
Their purpose is to perform specific actions without engaging the kernel.</p>
<p>Every system service is a system application that exposes the service.</p>
<h2 id="application-services"><a class="header" href="#application-services">Application services</a></h2>
<p>Application services, also called <em>userspace services</em>, are provided
by <a href="technical/../concepts/applications.html#services">applications themselves</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specifications"><a class="header" href="#specifications">Specifications</a></h1>
<p>This folder contains specification documents, which
purpose is to describe fully a specific concept or feature.
For more informations about low-level concepts these
documents refer to, you can check <a href="specs/../technical/README.html">technical documents</a> first.</p>
<ul>
<li><a href="specs/apps-and-libraries.html">Applications and libraries</a> - document describing common things between applications and libraries</li>
<li><a href="specs/applications.html">Applications</a> - how applications are structured</li>
<li><a href="specs/filesystem.html">Filesystem</a> - how the filesystem works</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="applications-and-libraries"><a class="header" href="#applications-and-libraries">Applications and libraries</a></h1>
<p>This document describes the structure, features and behaviours
to both <a href="specs/../concepts/applications.html">applications</a> and
<a href="specs/../concepts/libraries.html">libraries</a>.</p>
<ul>
<li><a href="specs/apps-and-libraries.html#applications-and-libraries">Applications and libraries</a>
<ul>
<li><a href="specs/apps-and-libraries.html#name-and-slug">Name and slug</a></li>
<li><a href="specs/apps-and-libraries.html#application-identifier">Application identifier</a></li>
<li><a href="specs/apps-and-libraries.html#features">Features</a></li>
<li><a href="specs/apps-and-libraries.html#manifest">Manifest</a></li>
</ul>
</li>
</ul>
<h2 id="name-and-slug"><a class="header" href="#name-and-slug">Name and slug</a></h2>
<p>Each application has a name as well as a slug. The name can any valid UTF-8 string, while the slug must respect several rules:</p>
<ul>
<li>Only lowercase letters, underscores and digits</li>
<li>Must not start by a digit</li>
<li>Must not be the name of a native shell command</li>
<li>Must not be the name of a native shell function</li>
<li>Must not be the name of a shell type</li>
</ul>
<p>By default, the slug is auto-generated from the name, but it can also be customized.</p>
<h2 id="application-identifier"><a class="header" href="#application-identifier">Application identifier</a></h2>
<p>The <em>Application identifier</em> (AID) is created using the slug and the developer's identifier (DID).</p>
<p>For example, an application with slug of <code>app</code> made by a developer
whose DID is <code>gulje</code> will get an AID of <code>gulje::app</code>.</p>
<p>The AID is unique across the store as well as in a single Violet installation.
As malicious application may provide the DID and the slug of a legit application
(<em>AID spoofing</em>), sideloading is verified by default.</p>
<p>System applications are registered under the reserved <code>sys</code> DID.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<p>Applications and libraries can define features that are optional parts in the application.
They are described in the manifest and can be enabled or disabled when installing
a program.</p>
<p>Each feature allows to embed additional assets and declare additional supported
languages and a specific build option.</p>
<p>This allows to save space and build time when a specific feature isn't required,
but should still embedded in the program itself instead of making an additional
application or library.</p>
<p>When the manifest declares one or more feature(s), it must also specify
a set of default features to enable.</p>
<h2 id="manifest"><a class="header" href="#manifest">Manifest</a></h2>
<pre><code class="language-toml">[infos]
name = &quot;Beautiful App&quot; #Â [REQ]
slug = &quot;beautiful-app&quot; #Â [REQ]
description = &quot;The most beautiful app on the Violet Store&quot; #Â [REQ]
version = &quot;1.0.0&quot; #Â [REQ]
authors = [ #Â [REQ]
  &quot;GÃ¼lce &lt;guljeee@yandex.com&gt;&quot;,
  &quot;Tuhana &lt;hi@tuhana.me&gt; (https://tuhana.me)&quot;
]
icons = &quot;assets/icons/app/%{}.png&quot; #Â [REQ]
license = &quot;Apache-2.0&quot; #Â [OPT] SPDX License Identifier

[content] #Â [OPT]
assets = [&quot;./assets&quot;]

[content.program] #Â [REQ]
precomp = &quot;main.vpp&quot; # &lt;for precomp packages&gt; [REQ]

#Â Packages can either contain source code only, pre-compiled programs only, or both
[content.program.source] #Â &lt;for source packages&gt; [REQ]
toolchain = &quot;rust&quot; # [REQ]
build = {} # [REQ]
options = { optimize = &quot;O3&quot; } # [OPT]

[dependencies.libraries] # [REQ]
sysver = &quot;^1.0.0&quot;

[features.testing] # [OPT]
assets = [] # [OPT]
dependencies = {} # [OPT]
languages = [] # [OPT]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="applications"><a class="header" href="#applications">Applications</a></h1>
<p>This document describes application-specific structure and behaviour. </p>
<ul>
<li><a href="specs/applications.html#applications">Applications</a>
<ul>
<li><a href="specs/applications.html#application-package">Application package</a>
<ul>
<li><a href="specs/applications.html#content">Content</a></li>
<li><a href="specs/applications.html#pre-compiled-applications">Pre-compiled applications</a></li>
<li><a href="specs/applications.html#embedding-libraries">Embedding libraries</a></li>
<li><a href="specs/applications.html#values-encoding">Values encoding</a></li>
<li><a href="specs/applications.html#returning-and-failing">Returning and failing</a></li>
<li><a href="specs/applications.html#volatile-applications">Volatile applications</a></li>
</ul>
</li>
<li><a href="specs/applications.html#commands">Commands</a>
<ul>
<li><a href="specs/applications.html#execution-context">Execution Context</a></li>
<li><a href="specs/applications.html#startup-reason">Startup Reason</a></li>
<li><a href="specs/applications.html#context-header">Context header</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="application-package"><a class="header" href="#application-package">Application package</a></h2>
<p>Application packages are files that have either the
<code>*.vap</code> (Violet Application Package) or
<code>*.vva</code> (Violet Volatile Application).</p>
<h3 id="content"><a class="header" href="#content">Content</a></h3>
<p>VAP and VVA files are ZStandard archives that contain <code>manifest.toml</code>
describing the archive and <code>hash.md5</code> file that confirm that the archive
is not corrupted.</p>
<h3 id="pre-compiled-applications"><a class="header" href="#pre-compiled-applications">Pre-compiled applications</a></h3>
<p>By default, the system tries to install
<a href="specs/../technical/pre-compiling.html">pre-compiled programs</a> from
the application's package if possible.</p>
<h3 id="embedding-libraries"><a class="header" href="#embedding-libraries">Embedding libraries</a></h3>
<p>Although it's a better practice to split applications and libraries
into different packages, sometimes it's more easy to embed both in
the same package, especially in two cases:</p>
<ul>
<li>When the application is just a thin layer ahead of the library (e.g. CLI tool)</li>
<li>When the library's API changes rapidly and the application relies on it</li>
</ul>
<p>For such scenarios, it's possible for an application package to embed one or more libraries, and publish them all at once.</p>
<h3 id="values-encoding"><a class="header" href="#values-encoding">Values encoding</a></h3>
<p>The application's startup arguments and output value use the following encoding:</p>
<div class="table-wrapper"><table><thead><tr><th>Type code</th><th>Type</th><th>Description</th><th>Representation</th></tr></thead><tbody>
<tr><td><code>0x00</code></td><td><code>void</code></td><td>-</td><td>nothing</td></tr>
<tr><td><code>0x01</code></td><td><code>bool</code></td><td>boolean</td><td>1 byte, <code>0x00</code> = false, <code>0x01</code> = true</td></tr>
<tr><td><code>0x02</code></td><td><code>int</code></td><td>64-bit signed integer number</td><td>-</td></tr>
<tr><td><code>0x03</code></td><td><code>float</code></td><td>64-bit signed floating-point number</td><td>-</td></tr>
<tr><td><code>0x04</code></td><td><code>char</code></td><td>UTF-8 grapheme cluster</td><td>character's length (8 bytes), followed by the UTF-8 grapheme cluster</td></tr>
<tr><td><code>0x05</code></td><td><code>string</code></td><td>UTF-8 string</td><td>string's length (8 bytes), followed by the UTF-8 encoded string</td></tr>
<tr><td><code>0x06</code></td><td><code>list</code></td><td>Typed linear list</td><td>Type code of the list's number of items (1 byte), length in bytes (64 bits), encoded items</td></tr>
<tr><td><code>0x07</code></td><td><code>path</code></td><td>Filesystem path</td><td>Represented as an UTF-8 string</td></tr>
<tr><td><code>0x08</code></td><td><code>command</code></td><td>Shell command</td><td>Represented as an UTF-8 string</td></tr>
<tr><td><code>0x09</code></td><td><code>stream</code></td><td>Pipe RC</td><td>RC identifier (8 bytes)</td></tr>
</tbody></table>
</div>
<h3 id="returning-and-failing"><a class="header" href="#returning-and-failing">Returning and failing</a></h3>
<p>The value must be returned using the <code>CMDOUT</code> pipe. The data sent through
this pipe must follow the above <a href="specs/applications.html#values-encoding">encoding</a>.</p>
<p>A command may also fail. To incidate so, the process must send the <code>0xFF</code>
value through the pipi.</p>
<h3 id="volatile-applications-1"><a class="header" href="#volatile-applications-1">Volatile applications</a></h3>
<p><a href="specs/../concepts/applications.html#volatile-applications">Volatile applications</a>
cannot expose commands globally as they are technically not installed.
They can though be used in shell scripts through <em>volatile imports</em>.</p>
<h2 id="commands-1"><a class="header" href="#commands-1">Commands</a></h2>
<h3 id="execution-context"><a class="header" href="#execution-context">Execution Context</a></h3>
<p>Execution context consists of the information given to the
application when the application starts and explains why
the application was started and what it is expected to do.</p>
<h3 id="startup-reason"><a class="header" href="#startup-reason">Startup Reason</a></h3>
<p>It's one-byte long and made of following bits:</p>
<ul>
<li>Bits 0-4
<ul>
<li><code>0b0001</code>: the application was started as part of its post-installation process</li>
<li><code>0b0010</code>: the application was started as part of its pre-update process</li>
<li><code>0b0011</code>: the application was started as part of its post-update process</li>
<li><code>0b0100</code>: the application was started as part of its pre-uninstallation process</li>
<li><code>0b0101</code>: the application was started by the system as an application service</li>
<li><code>0b0110</code>: the application was started by the desktop environment</li>
<li><code>0b0111</code>: the application was started by itself (from another process of the same application)</li>
<li><code>0b1000</code>: the application was started by another application</li>
<li><code>0b1001</code>: the application was started using one its exposed shell commands</li>
<li><code>0b1010</code>: the application was started as a desktop environment</li>
</ul>
</li>
<li>Bit 5: set if the application was started automatically after a crash</li>
<li>Bit 6: set if the application's raw output will be read (e.g. through the use of a shell operator)</li>
</ul>
<h3 id="context-header"><a class="header" href="#context-header">Context header</a></h3>
<ul>
<li>The startup reason (1 byte)</li>
<li>Informations (1 byte)
<ul>
<li>Bit 0: set if the application is starting for the very first time since it was installed</li>
<li>Bit 1: set if the application is starting for the very first time for this specific user</li>
<li>Bit 2: set if the application is starting for the very first time as this specific service</li>
<li>Bit 3: set if the application is starting for the first time after an update</li>
<li>Bit 4: set if other instances of this application are running</li>
</ul>
</li>
<li>Special assignment (1 byte)
<ul>
<li>Bit 0: set if the application is starting for the first time after being assigned as the new desktop environment</li>
<li>Bit 1: set if the application is starting for the first time after being assigned as the new default file manager</li>
</ul>
</li>
<li>Service type (1 byte)
<ul>
<li><code>0x00</code>: not run as a service</li>
<li><code>0x01</code>: run as the application's main service</li>
<li><code>0x02</code>: run as an application's scoped service</li>
<li><code>0x10</code>: run as the application's desktop environment service</li>
<li><code>0x11</code>: run as the application's file manager service</li>
<li><code>0x12</code>: run as the application's file opener service</li>
</ul>
</li>
<li>The application's ANID (4 bytes)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filesystem"><a class="header" href="#filesystem">Filesystem</a></h1>
<ul>
<li><a href="specs/filesystem.html#filesystem">Filesystem</a>
<ul>
<li><a href="specs/filesystem.html#structure">Structure</a></li>
</ul>
</li>
</ul>
<p>Violet uses the <strong>Btrfs</strong> filesystem for the main storage.</p>
<p>Three partitions are used to store the data:</p>
<ul>
<li>One <strong>FAT32</strong> partition for the bootloader</li>
<li>One <strong>FAT32</strong> partition for the system (<code>/sys</code> and <code>/etc/sys</code>)</li>
<li>One <strong>Btrfs</strong> partition for user data</li>
</ul>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<pre><code>/
âââ app                            Interactables available to all users
âÂ Â  âââ &lt;appname&gt;                  An application's folder (NOTE: one sub-folder per version for libraries)
âÂ Â      âââ content                Application's program (executables, static resources, ...)
âÂ Â      âââ crashsaves             Application's crash saves
âÂ Â      âââ data                   Application's data (e.g. database)
âÂ Â      âââ packages               Application's packages (original package + update packages)
âÂ Â      âââ sandboxes              Application's sandboxes
âââ dev                            Connected devices
â   âââ cam                        Cameras
â   âââ bst                        Basic storage devices (SD cards, USB keys, ...)
â   âââ etc                        Uncategorized devices
â   âââ mic                        Microphones
â   âââ net                        Network adapters (Ethernet adapter, WiFi card, ...)
â   âââ snd                        Sound-related output devices (Sound card, DAC, ...)
â   âââ sst                        Sensitive storage devices (Hard drives, SSDs, ...)
â   âââ wrl                        Other supported wireless devices (Bluetooth adapter, ...)
âââ etc                            Mutable data folder
âÂ Â  âââ env   &lt;F&gt;                  Environment variables
âÂ Â  âââ hosts &lt;F&gt;                  Hosts overriding (e.g. 'localhost')
âÂ Â  âââ lock                       Opened lock files
âÂ Â  âââ logs                       Log files
âÂ Â  |   âââ upe &lt;F&gt;                History of UPE requests
âÂ Â  âââ public                     Public data, readable and writable by everyone
âÂ Â  âââ sys                        System's mutable data - available to system only
âÂ Â      âââ registry &lt;F&gt;           System's registry
âÂ Â      âââ awake    &lt;F&gt;           System's shutdown indicator to detect if there was an error during last shutdown
âÂ Â      âââ hashes   &lt;F&gt;           Critical files' hashes for the integrity checker (2)
âÂ Â      âââ gbpwd    &lt;F&gt;           Global storage's encryption key
âÂ Â      âââ users    &lt;F&gt;           User profiles and groups
âââ fl                             Flow files
âââ home                           Users' data
âÂ Â  âââ &lt;user&gt;                     A specific user's data
âÂ Â      âââ apps                   User's applications (same structure as for `/apps`)
âÂ Â      âââ appdata                User's applications persistent data (not removed when the application is uninstalled)
âÂ Â      âââ desktop                User's files appearing on the desktop
âÂ Â      âââ documents              User's documents
âÂ Â      âââ downloads              User's downloads
âÂ Â      âââ music                  User's music files
âÂ Â      âââ pictures               User's pictures
âÂ Â      âââ videos                 User's videos
â       âââ trash                  User's trash
âââ mnt                            Mounted storages
âââ sys                            System - immutable outside of installation, repair processes and updates
âÂ Â  âââ apps                       System applications
âÂ Â  âââ boot                       System's boot program
âÂ Â  âââ langs                      Translation files
âÂ Â  âââ old                        Old versions of the system, used during the repair process (compressed archives)
âÂ Â  âââ backup                     Copy of the last system version (compressed archive)
âÂ Â  âââ kernel                     Sakura
âÂ Â  âââ valid   &lt;F&gt;                A file that just contains &quot;ValidMasterKey&quot; to test if the provided master key is valid at startup
âââ tmp                            Temporary folder (cleaned during shutdown)
Â  Â  âââ &lt;user&gt;                     Temporary folder for a specific user
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kernel"><a class="header" href="#kernel">Kernel</a></h1>
<p>Violet's kernel is called <em>Sakura</em>. 
This is a micro-kernel that tries to be as simple
and understandable as possible by delegating all tasks
such as file system, permission management to services.</p>
<p><strong>NOTE: This document is in its very early stages. Major changes
might be made to related documents.</strong></p>
<h2 id="documents"><a class="header" href="#documents">Documents</a></h2>
<ul>
<li><a href="specs/kernel/./kpc.html">Kernel-process communication</a> - how the processes communicate with kernel</li>
<li><a href="specs/kernel/./syscalls.html">System calls</a> - how to communicate with kernel through CPU interruptions</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kernel-process-communication"><a class="header" href="#kernel-process-communication">Kernel-process Communication</a></h1>
<p><em>Kernel-process Communication (KPC)</em> is a term that
describes how a process can communicate with the kernel.</p>
<p>There are two types of KPC:</p>
<ul>
<li><a href="specs/kernel/syscalls.html">System calls</a></li>
<li><a href="specs/kernel/kpc.html#">Signals (work in progress)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-calls"><a class="header" href="#system-calls">System calls</a></h1>
<p>System calls (syscalls) are a type of <a href="specs/kernel/./kpc.html">KPC</a>.
They allow a process to ask the kernel to perform
a task.</p>
<ul>
<li><a href="specs/kernel/syscalls.html#system-calls">System calls</a>
<ul>
<li><a href="specs/kernel/syscalls.html#overview">Overview</a></li>
<li><a href="specs/kernel/syscalls.html#list-of-syscalls">List of syscalls</a></li>
</ul>
</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Syscalls are performed using CPU interruptions to notify the kernel.</p>
<p>System calls always return two numbers: a 8-bit errcode and
8 bytes return value. If the errcode is not null, then an
error occured during the syscall. Certain error codes
indicate certain errors:</p>
<ul>
<li><code>0x00</code>: cannot read syscall's code or arguments</li>
<li><code>0x01</code>: syscall does not exists</li>
<li><code>0x02</code>: at least one argument is invalid (e.g. providing a pointer to the <code>0</code> address)</li>
<li><code>0x03</code>: unmapped memory pointer</li>
<li><code>0x04</code>: memory permission error</li>
<li><code>0x10</code> - <code>0x1F</code>: invalid argument(s) provided</li>
<li><code>0x20</code> - <code>0x2F</code>: provided arguments are not valid in the current context (in relation with other arguments)</li>
<li><code>0x30</code> - <code>0x3F</code>: provided arguments are not valid (after resources checking)</li>
<li><code>0x40</code> - <code>0x4F</code>: resource access error</li>
<li><code>0x50</code> - <code>0x5F</code>: hardware errors</li>
<li><code>0x60</code> - <code>0x6F</code>: other types of errors</li>
</ul>
<p>The codes of system calls are also categorized as follows:</p>
<ul>
<li><code>0x00</code> - <code>0x0F</code>: signal handling</li>
<li><code>0x10</code> - <code>0x1F</code>: process management</li>
<li><code>0x20</code> - <code>0x2F</code>: pipes</li>
<li><code>0x30</code> - <code>0x3F</code>: memory management</li>
<li><code>0x40</code> - <code>0x4F</code>: process management</li>
<li><code>0x50</code> - <code>0x5F</code>: hardware interaction</li>
<li><strong>TODO...</strong></li>
</ul>
<h2 id="list-of-syscalls"><a class="header" href="#list-of-syscalls">List of syscalls</a></h2>
<p><strong>TODO</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-services-1"><a class="header" href="#system-services-1">System services</a></h1>
<p>Since <a href="specs/services/../kernel/">Sakura</a> is microkernel, it only handles the most basic things.</p>
<p>System services are run by the system itself under the <code>sys</code> <a href="specs/services/../apps-and-libraries.html#application-identifier">DID</a>.</p>
<h1 id="list-of-system-services"><a class="header" href="#list-of-system-services">List of system services</a></h1>
<ul>
<li>PID 10: <a href="specs/services/"><code>sys::fs</code> (WIP)</a>: filesystem management service</li>
<li>PID 11: <a href="specs/services/"><code>sys::hw</code> (WIP)</a>: hardware communication service</li>
<li>PID 12: <a href="specs/services/"><code>sys::perm</code> (WIP)</a>: permissions management service</li>
<li>PID 13: <a href="specs/services/"><code>sys::net</code> (WIP)</a>: network communication service</li>
<li>PID 14: <a href="specs/services/"><code>sys::crypto</code> (WIP)</a>: cryptography service</li>
<li>PID 15: <a href="specs/services/"><code>sys::crashsave</code> (WIP)</a>: crash save management service</li>
<li>PID 16: <a href="specs/services/"><code>sys::flow</code> (WIP)</a>: flow management service</li>
<li>PID 17: <a href="specs/services/"><code>sys::i18n</code> (WIP)</a>: translation service</li>
<li>PID 18: <a href="specs/services/"><code>sys::ui</code> (WIP)</a>: user interface service</li>
<li>PID 19: <a href="specs/services/"><code>sys::app</code> (WIP)</a>: application management service</li>
<li>PID 20: <a href="specs/services/"><code>sys::process</code> (WIP)</a>: process management service</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="applications-1"><a class="header" href="#applications-1">Applications</a></h1>
<p>This folder contains documentation for each native application.</p>
<p>Below is the list of applications that are installed during
the installation process.</p>
<ul>
<li><a href="applications/index.html#applications">Applications</a>
<ul>
<li><a href="applications/index.html#suites">Suites</a></li>
</ul>
</li>
</ul>
<h2 id="suites"><a class="header" href="#suites">Suites</a></h2>
<ul>
<li><a href="applications/./dahlia.html">Dahlia</a>: complete toolchain allowing to build applications</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dahlia"><a class="header" href="#dahlia">Dahlia</a></h1>
<p>Dahlia is the toolchain required to build Violet applications.</p>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>Dahlia is made of several tools:</p>
<ul>
<li>A <em>builder</em>, which builds application packages from their manifest</li>
<li>A <em>publisher</em>, which allows to sign the application and upload it to the Store</li>
</ul>
<p>It relies on several external compilers (Rust, ...) to build
applications from source.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
